# Allow access from all domains for web fonts
# ------------------------------------------------------------------------------
<IfModule mod_headers.c>
	<FilesMatch "\.(eot|font.css|otf|ttc|ttf|woff)$">
		Header set Access-Control-Allow-Origin "*"
	</FilesMatch>
</IfModule>


# Proper MIME type for all files
# ------------------------------------------------------------------------------
<IfModule mod_mime.c>
	# Audio
	AddType audio/mp4                                 m4a f4a f4b
	AddType audio/ogg                                 oga ogg
	
	# JavaScript
	AddType application/javascript                    js
	AddType application/json                          json
	
	# Video
	AddType video/mp4                                 mp4 m4v f4v f4p
	AddType video/ogg                                 ogv
	AddType video/webm                                webm
	AddType video/x-flv                               flv
	
	# Web fonts
	AddType application/font-woff                     woff
	AddType application/vnd.ms-fontobject             eot
	AddType application/x-font-ttf                    ttc ttf
	AddType font/opentype                             otf
	
	# SVG
	AddType image/svg+xml                             svg svgz
	AddEncoding gzip                                  svgz
	
	# Other
	AddType application/octet-stream                  safariextz
	AddType application/x-chrome-extension            crx
	AddType application/x-opera-extension             oex
	AddType application/x-shockwave-flash             swf
	AddType application/x-web-app-manifest+json       webapp
	AddType application/x-xpinstall                   xpi
	AddType application/xml                           atom rdf rss xml
	AddType image/webp                                webp
	AddType image/x-icon                              ico
	AddType text/cache-manifest                       appcache manifest
	AddType text/vtt                                  vtt
	AddType text/x-component                          htc
	AddType text/x-vcard                              vcf
</IfModule>


# Compression: http://code.google.com/speed/page-speed/docs/payload.html#GzipCompression
# ------------------------------------------------------------------------------
<IfModule mod_deflate.c>
	AddOutputFilterByType DEFLATE application/atom+xml
	AddOutputFilterByType DEFLATE application/json
	AddOutputFilterByType DEFLATE application/xhtml+xml
	AddOutputFilterByType DEFLATE application/xml
	AddOutputFilterByType DEFLATE text/css
	AddOutputFilterByType DEFLATE text/html
	AddOutputFilterByType DEFLATE text/plain
	AddOutputFilterByType DEFLATE text/x-component
	AddOutputFilterByType DEFLATE text/xml
	
	# The following MIME types are in the process of registration
	AddOutputFilterByType DEFLATE application/xslt+xml
	AddOutputFilterByType DEFLATE image/svg+xml
	
	# The following MIME types are NOT registered
	AddOutputFilterByType DEFLATE application/mathml+xml
	AddOutputFilterByType DEFLATE application/rss+xml
	
	# JavaScript has various MIME types
	AddOutputFilterByType DEFLATE application/javascript
	AddOutputFilterByType DEFLATE application/x-javascript
	AddOutputFilterByType DEFLATE text/ecmascript
	AddOutputFilterByType DEFLATE text/javascript
	
	# .ico files and other compressible images
	AddOutputFilterByType DEFLATE image/vnd.microsoft.icon
	AddOutputFilterByType DEFLATE image/x-icon
	AddOutputFilterByType DEFLATE image/bmp
	AddOutputFilterByType DEFLATE image/tiff
	AddOutputFilterByType DEFLATE application/pdf
	
	# compressible fonts (.woff is already compressed)
	AddOutputFilterByType DEFLATE font/opentype
	AddOutputFilterByType DEFLATE application/x-font-ttf
	AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
</IfModule>


# Enabling filename rewriting (file.XXX.ext) if URL rewriting is enabled
# Otherwise URLs will use query strings (file.ext?v=XXX)
# More proxies cache assets if there is no query string
# ------------------------------------------------------------------------------
<IfModule mod_rewrite.c>
	RewriteEngine On
	RewriteBase /
	
	# Redirect www to non-www
	# RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
	# RewriteRule ^(.*)$ http://%1/$1 [R=301,L]
	
	# Setting up an environment variable so your code can detect if mod_rewrite rules are executable
	# in this folder and you can use file.123.jpg or you need to fall back to file.jpg?123
	RewriteRule . - [E=URLVERSIONREWRITE:YES]
	
	# Rewrites a version in file.123.jpg as well as timestamped version file.123_m_12345123512354.jpg
	# to original file.jpg so you can use it instead of file.jpg?123 which isn't cached in some proxies.
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteRule ^(.*)\.(\d+)(_m_\d+)?\.([^\.]+)$ $1.$4 [L,QSA]
	
	# Rewrites a version in file.ac123fe.jpg to original file.jpg
	# so you can use it instead of file.jpg?123 which isn't cached in some proxies.
	# Used for hash-based URLs where having a timestamp is not necessary.
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteRule ^(.*)\.([a-z\d]+)\.([^\.]+)$ $1.$3 [L,QSA]
</IfModule>


# Suppressing or Forcing the "www." at the beginning of URLs
# ------------------------------------------------------------------------------
# IMPORTANT: NEVER USE BOTH RULES AT THE SAME TIME!

# Option 1: rewrite www.example.com → example.com
<IfModule mod_rewrite.c>
	RewriteCond %{HTTPS} !=on
	RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
	RewriteRule ^ http://%1%{REQUEST_URI} [R=301,L]
</IfModule>

# Option 2: rewrite example.com → www.example.com
# Be aware that the following might not be a good idea if you use "real"
# subdomains for certain parts of your website.

# <IfModule mod_rewrite.c>
# RewriteCond %{HTTPS} !=on
# RewriteCond %{HTTP_HOST} !^www\..+$ [NC]
# RewriteCond %{HTTP_HOST} !=localhost [NC]
# RewriteCond %{HTTP_HOST} !=127.0.0.1
# RewriteRule ^ http://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
# </IfModule>


# Browser Caching: http://code.google.com/speed/page-speed/docs/caching.html#LeverageBrowserCaching
# ------------------------------------------------------------------------------
<IfModule mod_expires.c>
	ExpiresActive On
	
	ExpiresByType application/json                    "access plus 1 year"
	ExpiresByType application/pdf                     "access plus 1 year"
	ExpiresByType application/x-shockwave-flash       "access plus 1 year"
	ExpiresByType image/bmp                           "access plus 1 year"
	ExpiresByType image/gif                           "access plus 1 year"
	ExpiresByType image/jpeg                          "access plus 1 year"
	ExpiresByType image/png                           "access plus 1 year"
	ExpiresByType image/svg+xml                       "access plus 1 year"
	ExpiresByType image/tiff                          "access plus 1 year"
	ExpiresByType image/vnd.microsoft.icon            "access plus 1 year"
	ExpiresByType image/x-icon                        "access plus 1 year"
	ExpiresByType text/css                            "access plus 1 year"
	ExpiresByType video/x-flv                         "access plus 1 year"
	ExpiresByType application/vnd.bw-fontobject       "access plus 1 year"
	ExpiresByType application/x-font-ttf              "access plus 1 year"
	ExpiresByType application/font-woff               "access plus 1 year"
	ExpiresByType font/opentype                       "access plus 1 year"
	ExpiresByType image/webp                          "access plus 1 year"
	
	# The following MIME types are in the process of registration
	ExpiresByType application/xslt+xml                "access plus 1 year"
	ExpiresByType image/svg+xml                       "access plus 1 year"
	
	# The following MIME types are NOT registered
	ExpiresByType application/mathml+xml              "access plus 1 year"
	ExpiresByType application/rss+xml                 "access plus 1 year"
	
	# JavaScript has various MIME types
	ExpiresByType application/x-javascript            "access plus 1 year"
	ExpiresByType application/javascript              "access plus 1 year"
	ExpiresByType text/ecmascript                     "access plus 1 year"
	ExpiresByType text/javascript                     "access plus 1 year"
</IfModule>


# Disabling ETags: They are most likely misconfigured
# ------------------------------------------------------------------------------
<IfModule mod_headers.c>
	Header unset ETag
</IfModule>

# Remove ETags
FileETag None


# UTF-8 encoding:
# ------------------------------------------------------------------------------
# Use UTF-8 encoding for anything served text/plain or text/html
AddDefaultCharset utf-8

# Force UTF-8 for certain file formats.
<IfModule mod_mime.c>
	AddCharset utf-8 .atom .css .js .json .rss .vtt .webapp .xml
</IfModule>


# File access
# ------------------------------------------------------------------------------
# Block access to directories without a default document.
# Usually you should leave this uncommented because you shouldn't allow anyone
# to surf through every directory on your server (which may includes rather
# private places like the CMS's directories).

<IfModule mod_autoindex.c>
	Options -Indexes
</IfModule>

# Block access to hidden files and directories.
# This includes directories used by version control systems such as Git and SVN.
<IfModule mod_rewrite.c>
	RewriteCond %{SCRIPT_FILENAME} -d [OR]
	RewriteCond %{SCRIPT_FILENAME} -f
	RewriteRule "(^|/)\." - [F]
</IfModule>

# Block access to backup and source files.
# These files may be left by some text editors and can pose a great security
# danger when anyone has access to them.

<FilesMatch "(^#.*#|\.(bak|config|dist|fla|inc|ini|log|psd|sh|sql|sw[op])|~)$">
	Order allow,deny
	Deny from all
	Satisfy All
</FilesMatch>

# Increase cookie security
<IfModule mod_php5.c>
	php_value session.cookie_httponly true
</IfModule>